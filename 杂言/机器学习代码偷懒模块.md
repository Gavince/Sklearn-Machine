# 机器学习可重用模块

> 记录经常使用的代码模块，加快开发的效率

### 模型的K_fold 验证

```python
def get_out_fold(clf,x_train,y_train,x_test):
    oof_train = np.zeros((ntrain,))
    oof_test = np.zeros((ntest,))
    oof_test_skf = np.empty((NFOLDS,ntest))
    
    # kf.split 返回划分好的训练集和测试集的索引
    for i, (train_index,test_index) in enumerate(kf.split(x_train)):
        x_tr = x_train[train_index]
        y_tr = y_train[train_index]
        x_te = x_train[test_index]
        
        clf.fit(x_tr,y_tr)
        
        oof_train[test_index] = clf.predict(x_te)
        oof_test_skf[i,:] = clf.predict(x_test)
        
    oof_test[:] = oof_test_skf.mean(axis=0)
    return oof_train.reshape(-1,1),oof_test.reshape(-1,1)
```

### 时间记录

```python
from time import time
import datetime

datetime.datetime.fromtimestamp(time()-t0).strftime("%M:%S:%f")
```

### ROC曲线绘制

```python
from sklearn.metrics import roc_curve
from sklearn.metrics import roc_auc_score as AUC

# 必须指明少数类的label
FPR, recall, thresholds = roc_curve(y, clf_proba.decision_function(X), pos_label=1)
area = AUC(y, clf_proba.decision_function(X))

plt.figure()
plt.plot(FPR, recall, color="red",
         label = "ROC curve(area = %0.2f)" % area)
plt.plot([0, 1], [0, 1], c="black", linestyle = "--")
plt.xlim([-0.05, 1.05])
plt.ylim([-0.05, 1.05])
plt.xlabel('False Positive Rate')
plt.ylabel('Recall')
plt.title('Receiver operating characteristic example')
plt.legend(loc="lower right")
plt.show()
```

### 绘制3D图像

```python
from mpl_toolkits import mplot3d
def plot_3D(elev=30,azim=30,X=X,y=y):
    ax = plt.subplot(projection="3d")
    ax.scatter3D(X[:,0],X[:,1],r,c=y,s=50,cmap='rainbow')
    ax.view_init(elev=elev,azim=azim)
    ax.set_xlabel("x")
    ax.set_ylabel("y")
    ax.set_zlabel("r")
    plt.show()

```

### 绘制饼状图

```python
## 绘制饼状图，查看存活情况
train_data.Survived.value_counts().plot.pie(labeldistance = 1.1
                                            , autopct = "%1.2f%%" #显示百分比
                                            , shadow=False
                                            , startangle = 90
                                            , pctdistance = 0.6
                                           )
plt.legend()
plt.show()

```

### 先编码在转为哑变量

```python
# 首先转为数字形式的编码
combined_train_test.Embarked = pd.factorize(combined_train_test.Embarked)[0]
# 使用哑变量编码，消除特征之间的共性(参数prefix表示前缀)原则会以_1出现
embark_dummies_df = pd.get_dummies(combined_train_test.Embarked,prefix=combined_train_test[["Embarked"]].columns[0])
```



